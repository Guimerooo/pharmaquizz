<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PharmaQuizz - Application compl√®te</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState } = React;

    // === IC√îNES SVG ===
    const BookOpen = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
      </svg>
    );
    const Brain = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/>
        <path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/>
      </svg>
    );
    const Target = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/>
      </svg>
    );
    const TrendingUp = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/>
      </svg>
    );
    const ChevronLeft = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
    );
    const ChevronRight = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    );
    const Settings = ({ size = 24, style }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6"/>
      </svg>
    );
    const Plus = ({ size = 24, style }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    );
    const Trash2 = ({ size = 24, color }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color || "currentColor"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
      </svg>
    );
    const Edit = ({ size = 24, color }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color || "currentColor"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
      </svg>
    );
    const Camera = ({ size = 24, color }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color || "currentColor"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/>
      </svg>
    );
    const Check = ({ size = 24, style }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <polyline points="20 6 9 17 4 12"/>
      </svg>
    );
    const X = ({ size = 24, style }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );


const INITIAL_MEDS = [
  { 
    dci: "Parac√©tamol", 
    commercial: ["Dafalgan", "Panadol"], 
    category: "Antalgique", 
    image: null,
    lastReviewed: null, nextReview: Date.now(), interval: 1, easeFactor: 2.5, reviewCount: 0, correctCount: 0, incorrectCount: 0
  },
  { 
    dci: "Ibuprof√®ne", 
    commercial: ["Brufen", "Nurofen"], 
    category: "AINS", 
    image: null,
    lastReviewed: null, nextReview: Date.now(), interval: 1, easeFactor: 2.5, reviewCount: 0, correctCount: 0, incorrectCount: 0
  },
  { 
    dci: "Tramadol", 
    commercial: ["Contramal", "Tradonal"], 
    category: "Antalgique opio√Øde", 
    image: null,
    lastReviewed: null, nextReview: Date.now(), interval: 1, easeFactor: 2.5, reviewCount: 0, correctCount: 0, incorrectCount: 0
  },
  { 
    dci: "Alprazolam", 
    commercial: ["Xanax"], 
    category: "Anxiolytique", 
    image: null,
    lastReviewed: null, nextReview: Date.now(), interval: 1, easeFactor: 2.5, reviewCount: 0, correctCount: 0, incorrectCount: 0
  },
  { 
    dci: "Loraz√©pam", 
    commercial: ["Temesta"], 
    category: "Anxiolytique", 
    image: null,
    lastReviewed: null, nextReview: Date.now(), interval: 1, easeFactor: 2.5, reviewCount: 0, correctCount: 0, incorrectCount: 0
  },
  { 
    dci: "Insuline glargine", 
    commercial: ["Lantus", "Toujeo"], 
    category: "Antidiab√©tique", 
    image: null,
    lastReviewed: null, nextReview: Date.now(), interval: 1, easeFactor: 2.5, reviewCount: 0, correctCount: 0, incorrectCount: 0
  },
  { 
    dci: "Atorvastatine", 
    commercial: ["Lipitor", "Totalip"], 
    category: "Hypolip√©miant", 
    image: null,
    lastReviewed: null, nextReview: Date.now(), interval: 1, easeFactor: 2.5, reviewCount: 0, correctCount: 0, incorrectCount: 0
  }
];

const INITIAL_CLASSES = {
  'Antalgique': '#3B82F6',
  'AINS': '#EF4444',
  'Antalgique opio√Øde': '#DC2626',
  'Anxiolytique': '#14B8A6',
  'Antidiab√©tique': '#8B5CF6',
  'Hypolip√©miant': '#F59E0B',
  'Non attribu√©e': '#9CA3AF'
};

export default function PharmaQuizz() {
  console.log('=== PHARMAQUIZZ ULTIMATE CHARG√â ===');
  
  const [mode, setMode] = useState('menu');
  const [medications, setMedications] = useState(INITIAL_MEDS);
  const [therapeuticClasses, setTherapeuticClasses] = useState(INITIAL_CLASSES);
  const [shuffledMeds, setShuffledMeds] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [showAnswer, setShowAnswer] = useState(false);
  const [flashcardView, setFlashcardView] = useState('card');
  const [showSettings, setShowSettings] = useState(false);
  const [showManagement, setShowManagement] = useState(false);
  const [showStats, setShowStats] = useState(false);
  const [selectionMode, setSelectionMode] = useState('all');
  const [selectedClasses, setSelectedClasses] = useState([]);
  const [selectedMeds, setSelectedMeds] = useState([]);
  const [stats, setStats] = useState({ correct: 0, total: 0 });
  const [userAnswer, setUserAnswer] = useState('');
  const [showQuizFeedback, setShowQuizFeedback] = useState(false);
  const [quizHistory, setQuizHistory] = useState([]);
  const [showQuizHistory, setShowQuizHistory] = useState(false);
  const [currentQuizStart, setCurrentQuizStart] = useState(null);
  const [sortBy, setSortBy] = useState('dci');
  const [filterCategory, setFilterCategory] = useState('all');
  const [editingIndex, setEditingIndex] = useState(null);
  const [customMed, setCustomMed] = useState({ dci: '', commercial: '', category: '', image: null });
  const [searchQuery, setSearchQuery] = useState('');
  const [errorMessage, setErrorMessage] = useState('');
  const [showClassManager, setShowClassManager] = useState(false);
  const [newClassName, setNewClassName] = useState('');
  const [newClassColor, setNewClassColor] = useState('#64748b');
  const [editingClass, setEditingClass] = useState(null);
  const [flashcardListSort, setFlashcardListSort] = useState('dci');

  const currentMed = shuffledMeds[currentIndex];

  // ========== ALGORITHME SRS ==========
  const calculateNextReview = (med, quality) => {
    let newInterval = med.interval;
    let newEaseFactor = med.easeFactor;

    if (quality === 0) {
      newInterval = 1;
      newEaseFactor = Math.max(1.3, med.easeFactor - 0.2);
    } else if (quality === 1) {
      newInterval = Math.max(1, med.interval * 1.2);
      newEaseFactor = Math.max(1.3, med.easeFactor - 0.15);
    } else {
      if (med.reviewCount === 0) {
        newInterval = 1;
      } else if (med.reviewCount === 1) {
        newInterval = 6;
      } else {
        newInterval = Math.round(med.interval * med.easeFactor);
      }
      newEaseFactor = med.easeFactor + 0.1;
    }

    const now = Date.now();
    const nextReview = now + (newInterval * 24 * 60 * 60 * 1000);

    return {
      ...med,
      lastReviewed: now,
      nextReview,
      interval: newInterval,
      easeFactor: newEaseFactor,
      reviewCount: med.reviewCount + 1,
      correctCount: med.correctCount + (quality === 2 ? 1 : 0),
      incorrectCount: med.incorrectCount + (quality === 0 ? 1 : 0)
    };
  };

  const handleSRSResponse = (quality) => {
    const updated = calculateNextReview(currentMed, quality);
    const newMeds = medications.map(m => m.dci === currentMed.dci ? updated : m);
    setMedications(newMeds);
    const newShuffled = shuffledMeds.map(m => m.dci === currentMed.dci ? updated : m);
    setShuffledMeds(newShuffled);
    handleNext();
  };

  const getDueForReview = () => {
    const now = Date.now();
    return medications.filter(med => med.nextReview <= now);
  };

  // ========== STATISTIQUES ==========
  const getGlobalStats = () => {
    const totalReviewed = medications.filter(m => m.reviewCount > 0).length;
    const totalCorrect = medications.reduce((sum, m) => sum + m.correctCount, 0);
    const totalIncorrect = medications.reduce((sum, m) => sum + m.incorrectCount, 0);
    const totalAttempts = totalCorrect + totalIncorrect;
    const successRate = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;

    const byCategory = {};
    medications.forEach(med => {
      if (!byCategory[med.category]) {
        byCategory[med.category] = { correct: 0, incorrect: 0, total: 0 };
      }
      byCategory[med.category].correct += med.correctCount;
      byCategory[med.category].incorrect += med.incorrectCount;
      byCategory[med.category].total += med.correctCount + med.incorrectCount;
    });

    const hardest = [...medications]
      .filter(m => m.reviewCount > 0)
      .sort((a, b) => {
        const rateA = a.correctCount / (a.correctCount + a.incorrectCount || 1);
        const rateB = b.correctCount / (b.correctCount + b.incorrectCount || 1);
        return rateA - rateB;
      })
      .slice(0, 10);

    return {
      totalMeds: medications.length,
      totalReviewed,
      totalAttempts,
      successRate,
      byCategory,
      hardest,
      dueToday: getDueForReview().length
    };
  };

  // ========== FONCTIONS UTILITAIRES ==========
  const normalizeString = (str) => str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9]/g, "");

  const levenshteinDistance = (str1, str2) => {
    const matrix = [];
    for (let i = 0; i <= str2.length; i++) matrix[i] = [i];
    for (let j = 0; j <= str1.length; j++) matrix[0][j] = j;
    for (let i = 1; i <= str2.length; i++) {
      for (let j = 1; j <= str1.length; j++) {
        matrix[i][j] = str2.charAt(i - 1) === str1.charAt(j - 1) ? matrix[i - 1][j - 1] : Math.min(matrix[i - 1][j - 1] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j] + 1);
      }
    }
    return matrix[str2.length][str1.length];
  };

  const checkAnswer = (userAns, correctAns) => {
    const normalized1 = normalizeString(userAns);
    const normalized2 = normalizeString(correctAns);
    return levenshteinDistance(normalized1, normalized2) <= Math.floor(normalized2.length * 0.2);
  };

  const getCategories = () => [...new Set(medications.map(med => med.category))].sort();
  const getClassColor = (className) => therapeuticClasses[className] || '#64748b';

  const getSortedMedications = () => {
    let sorted = [...medications];
    if (searchQuery.trim()) {
      const query = searchQuery.toLowerCase();
      sorted = sorted.filter(med => 
        med.dci.toLowerCase().includes(query) ||
        med.commercial.some(name => name.toLowerCase().includes(query)) ||
        med.category.toLowerCase().includes(query)
      );
    }
    if (filterCategory !== 'all') sorted = sorted.filter(med => med.category === filterCategory);
    switch(sortBy) {
      case 'dci': sorted.sort((a, b) => a.dci.localeCompare(b.dci)); break;
      case 'commercial': sorted.sort((a, b) => a.commercial[0].localeCompare(b.commercial[0])); break;
      case 'category': sorted.sort((a, b) => a.category.localeCompare(b.category)); break;
    }
    return sorted;
  };

  const getFlashcardListMedications = () => {
    let sorted = [...shuffledMeds];
    if (searchQuery.trim()) {
      const query = searchQuery.toLowerCase();
      sorted = sorted.filter(med => 
        med.dci.toLowerCase().includes(query) ||
        med.commercial.some(name => name.toLowerCase().includes(query)) ||
        med.category.toLowerCase().includes(query)
      );
    }
    switch(flashcardListSort) {
      case 'dci': sorted.sort((a, b) => a.dci.localeCompare(b.dci)); break;
      case 'commercial': sorted.sort((a, b) => a.commercial[0].localeCompare(b.commercial[0])); break;
      case 'category': sorted.sort((a, b) => a.category.localeCompare(b.category)); break;
    }
    return sorted;
  };

  const handleQuizSubmit = (e) => {
    e.preventDefault();
    if (!userAnswer.trim()) return;
    const isCorrect = checkAnswer(userAnswer, currentMed.dci);
    setShowQuizFeedback(true);
    setStats({ correct: stats.correct + (isCorrect ? 1 : 0), total: stats.total + 1 });
  };

  const handleNext = () => {
    if (currentIndex < shuffledMeds.length - 1) {
      setCurrentIndex(currentIndex + 1);
      setShowAnswer(false);
      if (mode === 'quiz') {
        setUserAnswer('');
        setShowQuizFeedback(false);
      }
    } else {
      if (mode === 'quiz' && currentQuizStart) {
        setQuizHistory([{
          date: currentQuizStart,
          score: stats.correct,
          total: stats.total,
          percentage: Math.round((stats.correct / stats.total) * 100),
          completed: true
        }, ...quizHistory]);
      }
      setMode('menu');
      setShuffledMeds([]);
    }
  };

  const applySelection = () => {
    let medsIndices = [];
    if (selectionMode === 'all') {
      medsIndices = medications.map((_, i) => i);
    } else if (selectionMode === 'class') {
      medsIndices = medications.map((med, i) => selectedClasses.includes(med.category) ? i : -1).filter(i => i !== -1);
    } else if (selectionMode === 'review') {
      const due = getDueForReview();
      medsIndices = medications.map((med, i) => due.includes(med) ? i : -1).filter(i => i !== -1);
    } else {
      medsIndices = selectedMeds;
    }
    
    if (medsIndices.length === 0) {
      alert('Aucun m√©dicament s√©lectionn√©');
      return;
    }
    
    const medsToUse = medsIndices.map(i => medications[i]);
    setShuffledMeds([...medsToUse].sort(() => Math.random() - 0.5));
    setCurrentIndex(0);
    setShowAnswer(false);
    setStats({ correct: 0, total: 0 });
    setShowSettings(false);
    
    if (mode === 'quiz') {
      setCurrentQuizStart(new Date());
      setUserAnswer('');
      setShowQuizFeedback(false);
    }
  };

  const startMode = (newMode) => {
    setMode(newMode);
    const medsToUse = [...medications];
    setShuffledMeds([...medsToUse].sort(() => Math.random() - 0.5));
    setCurrentIndex(0);
    setShowAnswer(false);
    setStats({ correct: 0, total: 0 });
    setSearchQuery('');
    if (newMode === 'flashcard') {
      setFlashcardView('card');
    }
    if (newMode === 'quiz') {
      setCurrentQuizStart(new Date());
      setUserAnswer('');
      setShowQuizFeedback(false);
    }
  };

  const startReviewMode = () => {
    const due = getDueForReview();
    if (due.length === 0) {
      alert('Aucune r√©vision pr√©vue aujourd\'hui ! üéâ');
      return;
    }
    setMode('review');
    setShuffledMeds([...due].sort(() => Math.random() - 0.5));
    setCurrentIndex(0);
    setShowAnswer(false);
  };

  const startEditMedication = (index) => {
    const med = medications[index];
    setCustomMed({ dci: med.dci, commercial: med.commercial.join(', '), category: med.category, image: med.image });
    setEditingIndex(index);
  };

  const cancelEdit = () => {
    setEditingIndex(null);
    setCustomMed({ dci: '', commercial: '', category: '', image: null });
    setErrorMessage('');
    setShowClassManager(false);
    setEditingClass(null);
  };

  const saveMedication = () => {
    if (!customMed.dci || !customMed.commercial || !customMed.category) {
      setErrorMessage('‚ö†Ô∏è Veuillez remplir tous les champs obligatoires (DCI, Nom commercial, Classe)');
      setTimeout(() => setErrorMessage(''), 3000);
      return;
    }
    
    const newMed = {
      dci: customMed.dci,
      commercial: customMed.commercial.split(',').map(s => s.trim()).filter(s => s),
      category: customMed.category,
      image: customMed.image,
      lastReviewed: null,
      nextReview: Date.now(),
      interval: 1,
      easeFactor: 2.5,
      reviewCount: 0,
      correctCount: 0,
      incorrectCount: 0
    };
    
    if (editingIndex !== null) {
      const updated = [...medications];
      newMed.lastReviewed = medications[editingIndex].lastReviewed;
      newMed.nextReview = medications[editingIndex].nextReview;
      newMed.interval = medications[editingIndex].interval;
      newMed.easeFactor = medications[editingIndex].easeFactor;
      newMed.reviewCount = medications[editingIndex].reviewCount;
      newMed.correctCount = medications[editingIndex].correctCount;
      newMed.incorrectCount = medications[editingIndex].incorrectCount;
      updated[editingIndex] = newMed;
      setMedications(updated);
      setEditingIndex(null);
    } else {
      setMedications([...medications, newMed]);
    }
    setCustomMed({ dci: '', commercial: '', category: '', image: null });
    setErrorMessage('');
  };

  const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => setCustomMed({...customMed, image: reader.result});
      reader.readAsDataURL(file);
    }
  };

  const addNewClass = () => {
    if (!newClassName.trim()) {
      setErrorMessage('‚ö†Ô∏è Veuillez entrer un nom de classe');
      setTimeout(() => setErrorMessage(''), 3000);
      return;
    }
    if (getCategories().includes(newClassName.trim())) {
      setErrorMessage('‚ö†Ô∏è Cette classe existe d√©j√†');
      setTimeout(() => setErrorMessage(''), 3000);
      return;
    }
    setTherapeuticClasses({...therapeuticClasses, [newClassName.trim()]: newClassColor});
    setCustomMed({...customMed, category: newClassName.trim()});
    setNewClassName('');
    setNewClassColor('#64748b');
    setShowClassManager(false);
    setErrorMessage('');
  };

  const updateClass = (oldName, newName, newColor) => {
    if (!newName.trim()) {
      setErrorMessage('‚ö†Ô∏è Veuillez entrer un nom de classe');
      setTimeout(() => setErrorMessage(''), 3000);
      return;
    }
    if (newName !== oldName && getCategories().includes(newName.trim())) {
      setErrorMessage('‚ö†Ô∏è Cette classe existe d√©j√†');
      setTimeout(() => setErrorMessage(''), 3000);
      return;
    }
    const updatedClasses = {...therapeuticClasses};
    delete updatedClasses[oldName];
    updatedClasses[newName.trim()] = newColor;
    setTherapeuticClasses(updatedClasses);
    const updatedMeds = medications.map(med => 
      med.category === oldName ? {...med, category: newName.trim()} : med
    );
    setMedications(updatedMeds);
    setEditingClass(null);
    setErrorMessage('');
  };

  const ImagePlaceholder = () => (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
      <circle cx="8.5" cy="8.5" r="1.5"/>
      <polyline points="21 15 16 10 5 21"/>
    </svg>
  );

  const globalStats = getGlobalStats();

  return (
    <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', padding: '1rem' }}>
      <style>{`.button-hover { transition: all 0.3s; } .button-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }`}</style>

      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        <div style={{ background: 'linear-gradient(135deg, #1e293b 0%, #334155 100%)', padding: '1.5rem', color: 'white', textAlign: 'center', borderRadius: '20px 20px 0 0' }}>
          <h1 style={{ margin: 0, fontSize: '1.8rem', fontWeight: 700 }}>PharmaQuizz</h1>
          <p style={{ margin: '0.5rem 0 0 0', opacity: 0.9, fontSize: '0.85rem' }}>
            {medications.length} m√©dicaments ‚Ä¢ {globalStats.dueToday} √† r√©viser aujourd'hui
          </p>
          {stats.total > 0 && (
            <div style={{ marginTop: '1rem', padding: '0.75rem', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '12px' }}>
              <div style={{ fontSize: '0.85rem', opacity: 0.8 }}>Score</div>
              <div style={{ fontSize: '1.5rem', fontWeight: 700 }}>{Math.round((stats.correct / stats.total) * 100)}% ({stats.correct}/{stats.total})</div>
            </div>
          )}
        </div>

        <div style={{ background: 'white', borderRadius: '0 0 20px 20px', padding: '1.5rem', boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)', minHeight: '400px' }}>
          
          {mode === 'menu' && (
            <div>
              <h2 style={{ textAlign: 'center', marginBottom: '2rem', color: '#1e293b', fontSize: '1.8rem' }}>Choisissez votre mode</h2>
              
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>
                <div style={{ padding: '1rem', background: '#EFF6FF', borderRadius: '12px', border: '2px solid #3B82F6' }}>
                  <div style={{ fontSize: '0.75rem', color: '#3B82F6', fontWeight: 600, marginBottom: '0.25rem' }}>R√âVIS√âS</div>
                  <div style={{ fontSize: '1.5rem', fontWeight: 700, color: '#1e293b' }}>{globalStats.totalReviewed}/{globalStats.totalMeds}</div>
                </div>
                <div style={{ padding: '1rem', background: '#F0FDF4', borderRadius: '12px', border: '2px solid #10B981' }}>
                  <div style={{ fontSize: '0.75rem', color: '#10B981', fontWeight: 600, marginBottom: '0.25rem' }}>TAUX R√âUSSITE</div>
                  <div style={{ fontSize: '1.5rem', fontWeight: 700, color: '#1e293b' }}>{globalStats.successRate}%</div>
                </div>
                <div style={{ padding: '1rem', background: '#FEF3C7', borderRadius: '12px', border: '2px solid #F59E0B' }}>
                  <div style={{ fontSize: '0.75rem', color: '#F59E0B', fontWeight: 600, marginBottom: '0.25rem' }}>√Ä R√âVISER</div>
                  <div style={{ fontSize: '1.5rem', fontWeight: 700, color: '#1e293b' }}>{globalStats.dueToday}</div>
                </div>
              </div>

              <div style={{ display: 'grid', gap: '1rem', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', marginBottom: '1rem' }}>
                <button onClick={() => startMode('flashcard')} className="button-hover" style={{ background: 'linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)', border: 'none', borderRadius: '16px', padding: '2rem', color: 'white', cursor: 'pointer', position: 'relative', textAlign: 'center' }}>
                  <div style={{ position: 'absolute', top: '2rem', left: '2rem' }}><BookOpen size={24} /></div>
                  <div>
                    <div style={{ fontSize: '1.3rem', fontWeight: 700, marginBottom: '0.5rem' }}>Flashcards</div>
                    <div style={{ fontSize: '0.9rem', opacity: 0.9 }}>Apprentissage</div>
                  </div>
                </button>
                
                <button onClick={startReviewMode} className="button-hover" style={{ background: 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)', border: 'none', borderRadius: '16px', padding: '2rem', color: 'white', cursor: 'pointer', position: 'relative', textAlign: 'center' }}>
                  <div style={{ position: 'absolute', top: '2rem', left: '2rem' }}><Target size={24} /></div>
                  <div>
                    <div style={{ fontSize: '1.3rem', fontWeight: 700, marginBottom: '0.5rem' }}>R√©visions</div>
                    <div style={{ fontSize: '0.9rem', opacity: 0.9 }}>{globalStats.dueToday} cartes</div>
                  </div>
                </button>
                
                <button onClick={() => startMode('quiz')} className="button-hover" style={{ background: 'linear-gradient(135deg, #EF4444 0%, #DC2626 100%)', border: 'none', borderRadius: '16px', padding: '2rem', color: 'white', cursor: 'pointer', position: 'relative', textAlign: 'center' }}>
                  <div style={{ position: 'absolute', top: '2rem', left: '2rem' }}><Brain size={24} /></div>
                  <div>
                    <div style={{ fontSize: '1.3rem', fontWeight: 700, marginBottom: '0.5rem' }}>Quiz</div>
                    <div style={{ fontSize: '0.9rem', opacity: 0.9 }}>Test</div>
                  </div>
                </button>
                
                <button onClick={() => setShowStats(true)} className="button-hover" style={{ background: 'linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)', border: 'none', borderRadius: '16px', padding: '2rem', color: 'white', cursor: 'pointer', position: 'relative', textAlign: 'center' }}>
                  <div style={{ position: 'absolute', top: '2rem', left: '2rem' }}><TrendingUp size={24} /></div>
                  <div>
                    <div style={{ fontSize: '1.3rem', fontWeight: 700, marginBottom: '0.5rem' }}>Statistiques</div>
                    <div style={{ fontSize: '0.9rem', opacity: 0.9 }}>Progression</div>
                  </div>
                </button>
              </div>
            </div>
          )}

          {/* MODAL STATISTIQUES */}
          {showStats && (
            <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem' }} onClick={() => setShowStats(false)}>
              <div onClick={(e) => e.stopPropagation()} style={{ background: 'white', borderRadius: '20px', padding: '2rem', maxWidth: '800px', width: '100%', maxHeight: '90vh', overflowY: 'auto' }}>
                <h2 style={{ fontSize: '1.5rem', marginBottom: '1.5rem', color: '#1e293b', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                  <TrendingUp size={24} /> Statistiques d√©taill√©es
                </h2>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>
                  <div style={{ padding: '1.5rem', background: '#F0F9FF', borderRadius: '12px' }}>
                    <div style={{ fontSize: '0.85rem', color: '#64748b', marginBottom: '0.5rem' }}>Total r√©visions</div>
                    <div style={{ fontSize: '2rem', fontWeight: 700, color: '#0EA5E9' }}>{globalStats.totalAttempts}</div>
                  </div>
                  <div style={{ padding: '1.5rem', background: '#F0FDF4', borderRadius: '12px' }}>
                    <div style={{ fontSize: '0.85rem', color: '#64748b', marginBottom: '0.5rem' }}>Taux de r√©ussite</div>
                    <div style={{ fontSize: '2rem', fontWeight: 700, color: '#10B981' }}>{globalStats.successRate}%</div>
                  </div>
                  <div style={{ padding: '1.5rem', background: '#FEF3C7', borderRadius: '12px' }}>
                    <div style={{ fontSize: '0.85rem', color: '#64748b', marginBottom: '0.5rem' }}>M√©dicaments r√©vis√©s</div>
                    <div style={{ fontSize: '2rem', fontWeight: 700, color: '#F59E0B' }}>{globalStats.totalReviewed}/{globalStats.totalMeds}</div>
                  </div>
                </div>

                <h3 style={{ fontSize: '1.2rem', marginBottom: '1rem', color: '#1e293b' }}>Par classe th√©rapeutique</h3>
                <div style={{ marginBottom: '2rem' }}>
                  {Object.entries(globalStats.byCategory).map(([cat, data]) => {
                    const rate = data.total > 0 ? Math.round((data.correct / data.total) * 100) : 0;
                    return (
                      <div key={cat} style={{ marginBottom: '1rem' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                          <div style={{ fontWeight: 600, color: '#1e293b' }}>{cat}</div>
                          <div style={{ fontSize: '0.9rem', color: '#64748b' }}>{rate}% ({data.correct}/{data.total})</div>
                        </div>
                        <div style={{ width: '100%', height: '8px', background: '#e2e8f0', borderRadius: '4px', overflow: 'hidden' }}>
                          <div style={{ width: `${rate}%`, height: '100%', background: getClassColor(cat), transition: 'width 0.3s' }} />
                        </div>
                      </div>
                    );
                  })}
                </div>

                {globalStats.hardest.length > 0 && (
                  <>
                    <h3 style={{ fontSize: '1.2rem', marginBottom: '1rem', color: '#1e293b' }}>M√©dicaments les plus difficiles</h3>
                    <div style={{ maxHeight: '300px', overflowY: 'auto' }}>
                      {globalStats.hardest.map((med, i) => {
                        const rate = med.correctCount / (med.correctCount + med.incorrectCount || 1);
                        return (
                          <div key={i} style={{ padding: '0.75rem', background: '#FEE2E2', border: '2px solid #EF4444', borderRadius: '8px', marginBottom: '0.5rem' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                              <div>
                                <div style={{ fontWeight: 700, color: '#1e293b' }}>{med.commercial[0]}</div>
                                <div style={{ fontSize: '0.8rem', color: '#64748b' }}>{med.dci}</div>
                              </div>
                              <div style={{ textAlign: 'right' }}>
                                <div style={{ fontSize: '1.2rem', fontWeight: 700, color: '#DC2626' }}>{Math.round(rate * 100)}%</div>
                                <div style={{ fontSize: '0.75rem', color: '#64748b' }}>{med.correctCount}/{med.correctCount + med.incorrectCount}</div>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </>
                )}

                <button onClick={() => setShowStats(false)} className="button-hover" style={{ width: '100%', marginTop: '1.5rem', padding: '1rem', background: '#e2e8f0', border: 'none', borderRadius: '12px', color: '#1e293b', cursor: 'pointer', fontWeight: 600 }}>
                  Fermer
                </button>
              </div>
            </div>
          )}

          {/* MODE FLASHCARD */}
          {mode === 'flashcard' && currentMed && (
            <div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem', flexWrap: 'wrap', gap: '1rem' }}>
                <div style={{ fontSize: '0.9rem', color: '#64748b', fontWeight: 600 }}>{currentIndex + 1} / {shuffledMeds.length}</div>
                <div style={{ display: 'flex', gap: '0.5rem' }}>
                  <button onClick={() => setShowSettings(true)} className="button-hover" style={{ padding: '0.6rem', background: '#f1f5f9', border: '2px solid #e2e8f0', borderRadius: '8px', cursor: 'pointer' }}>
                    <Settings size={20} style={{ color: '#64748b' }} />
                  </button>
                  <button onClick={() => setShowManagement(true)} className="button-hover" style={{ padding: '0.6rem', background: '#D1FAE5', border: '2px solid #10B981', borderRadius: '8px', cursor: 'pointer' }}>
                    <Plus size={20} style={{ color: '#10B981' }} />
                  </button>
                  <button onClick={() => setFlashcardView('card')} className="button-hover" style={{ padding: '0.5rem 1rem', background: flashcardView === 'card' ? '#334155' : '#e2e8f0', border: 'none', borderRadius: '8px', color: flashcardView === 'card' ? 'white' : '#64748b', cursor: 'pointer', fontSize: '0.9rem', fontWeight: 600 }}>
                    Carte
                  </button>
                  <button onClick={() => setFlashcardView('list')} className="button-hover" style={{ padding: '0.5rem 1rem', background: flashcardView === 'list' ? '#334155' : '#e2e8f0', border: 'none', borderRadius: '8px', color: flashcardView === 'list' ? 'white' : '#64748b', cursor: 'pointer', fontSize: '0.9rem', fontWeight: 600 }}>
                    Liste
                  </button>
                </div>
              </div>

              {flashcardView === 'card' ? (
                <>
                  <div 
                    onClick={() => setShowAnswer(!showAnswer)} 
                    style={{ 
                      background: showAnswer ? getClassColor(currentMed.category) : 'white', 
                      borderRadius: '20px', 
                      padding: '3rem 2rem', 
                      cursor: 'pointer', 
                      minHeight: '300px', 
                      display: 'flex', 
                      flexDirection: 'column', 
                      alignItems: 'center', 
                      justifyContent: 'center', 
                      transition: 'all 0.4s', 
                      boxShadow: showAnswer ? '0 10px 40px rgba(0, 0, 0, 0.1)' : `0 10px 40px ${getClassColor(currentMed.category)}40`, 
                      border: showAnswer ? 'none' : `3px solid ${getClassColor(currentMed.category)}` 
                    }}
                  >
                    {currentMed.image && !showAnswer && (
                      <img src={currentMed.image} alt={currentMed.dci} style={{ maxWidth: '200px', maxHeight: '150px', objectFit: 'contain', marginBottom: '1rem', borderRadius: '12px' }} />
                    )}
                    <div style={{ fontSize: '0.85rem', color: showAnswer ? 'rgba(255, 255, 255, 0.9)' : getClassColor(currentMed.category), marginBottom: '1rem', textTransform: 'uppercase', letterSpacing: '0.1em', fontWeight: 700 }}>
                      {showAnswer ? 'DCI' : 'Nom Commercial'}
                    </div>
                    <div style={{ fontSize: showAnswer ? '2.5rem' : '1.8rem', fontWeight: 700, color: showAnswer ? 'white' : '#1e293b', marginBottom: '1rem', textAlign: 'center' }}>
                      {showAnswer ? currentMed.dci : currentMed.commercial.join(' ‚Ä¢ ')}
                    </div>
                    <div style={{ display: 'inline-block', padding: '0.5rem 1.5rem', background: showAnswer ? 'rgba(255, 255, 255, 0.2)' : `${getClassColor(currentMed.category)}20`, borderRadius: '20px', color: showAnswer ? 'white' : getClassColor(currentMed.category), fontSize: '0.85rem', fontWeight: 600 }}>
                      {currentMed.category}
                    </div>
                  </div>
                  
                  <div style={{ display: 'flex', gap: '1rem', marginTop: '2rem' }}>
                    <button onClick={() => currentIndex > 0 && (setCurrentIndex(currentIndex - 1), setShowAnswer(false))} disabled={currentIndex === 0} className="button-hover" style={{ flex: 1, padding: '1rem', background: currentIndex === 0 ? '#f1f5f9' : '#e2e8f0', border: 'none', borderRadius: '12px', color: currentIndex === 0 ? '#cbd5e1' : '#1e293b', cursor: currentIndex === 0 ? 'not-allowed' : 'pointer', fontWeight: 600, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>
                      <ChevronLeft size={20} />
                      <span>Pr√©c√©dent</span>
                    </button>
                    <button onClick={() => setMode('menu')} className="button-hover" style={{ flex: 1, padding: '1rem', background: '#e2e8f0', border: 'none', borderRadius: '12px', color: '#1e293b', cursor: 'pointer', fontWeight: 600 }}>
                      Menu
                    </button>
                    <button onClick={handleNext} className="button-hover" style={{ flex: 1, padding: '1rem', background: '#334155', border: 'none', borderRadius: '12px', color: 'white', cursor: 'pointer', fontWeight: 600, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>
                      <span>Suivant</span>
                      <ChevronRight size={20} />
                    </button>
                  </div>
                </>
              ) : (
                <div>
                  <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem' }}>
                    <input type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="üîç Rechercher..." style={{ flex: 1, padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.9rem' }} />
                    <select value={flashcardListSort} onChange={(e) => setFlashcardListSort(e.target.value)} style={{ padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.9rem', cursor: 'pointer', background: 'white' }}>
                      <option value="dci">Tri: DCI A-Z</option>
                      <option value="commercial">Tri: Commercial A-Z</option>
                      <option value="category">Tri: Par classe</option>
                    </select>
                  </div>
                  <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                    {getFlashcardListMedications().map((med, i) => (
                      <div key={i} style={{ padding: '1rem', background: 'white', border: `3px solid ${getClassColor(med.category)}`, borderRadius: '12px', marginBottom: '0.75rem', display: 'flex', gap: '1rem' }}>
                        {med.image ? (
                          <img src={med.image} alt={med.dci} style={{ width: '60px', height: '60px', objectFit: 'cover', borderRadius: '8px', border: `2px solid ${getClassColor(med.category)}` }} />
                        ) : (
                          <div style={{ width: '60px', height: '60px', background: '#f1f5f9', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#cbd5e1' }}>
                            <ImagePlaceholder />
                          </div>
                        )}
                        <div style={{ flex: 1 }}>
                          <div style={{ fontSize: '1rem', fontWeight: 700, color: '#1e293b' }}>{med.commercial.join(' ‚Ä¢ ')}</div>
                          <div style={{ fontSize: '0.9rem', color: '#64748b' }}>{med.dci}</div>
                          <div style={{ display: 'inline-block', padding: '0.25rem 0.75rem', background: `${getClassColor(med.category)}20`, borderRadius: '12px', color: getClassColor(med.category), fontSize: '0.75rem', fontWeight: 600, marginTop: '0.5rem' }}>
                            {med.category}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                  <button onClick={() => setMode('menu')} className="button-hover" style={{ width: '100%', marginTop: '1rem', padding: '1rem', background: '#e2e8f0', border: 'none', borderRadius: '12px', color: '#1e293b', cursor: 'pointer', fontWeight: 600 }}>
                    Menu
                  </button>
                </div>
              )}
            </div>
          )}

          {/* MODE REVIEW (R√âVISIONS) AVEC SRS */}
          {mode === 'review' && currentMed && (
            <div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                <div style={{ fontSize: '0.9rem', color: '#64748b', fontWeight: 600 }}>R√©vision {currentIndex + 1} / {shuffledMeds.length}</div>
                <button onClick={() => setMode('menu')} className="button-hover" style={{ padding: '0.6rem 1rem', background: '#e2e8f0', border: '2px solid #cbd5e1', borderRadius: '8px', cursor: 'pointer', fontWeight: 600, color: '#1e293b', fontSize: '0.9rem' }}>
                  Menu
                </button>
              </div>

              <div 
                onClick={() => setShowAnswer(!showAnswer)} 
                style={{ 
                  background: showAnswer ? getClassColor(currentMed.category) : 'white', 
                  borderRadius: '20px', 
                  padding: '3rem 2rem', 
                  cursor: 'pointer', 
                  minHeight: '300px', 
                  display: 'flex', 
                  flexDirection: 'column', 
                  alignItems: 'center', 
                  justifyContent: 'center', 
                  transition: 'all 0.4s', 
                  boxShadow: showAnswer ? '0 10px 40px rgba(0, 0, 0, 0.1)' : `0 10px 40px ${getClassColor(currentMed.category)}40`, 
                  border: showAnswer ? 'none' : `3px solid ${getClassColor(currentMed.category)}` 
                }}
              >
                {currentMed.image && !showAnswer && (
                  <img src={currentMed.image} alt={currentMed.dci} style={{ maxWidth: '200px', maxHeight: '150px', objectFit: 'contain', marginBottom: '1rem', borderRadius: '12px' }} />
                )}
                <div style={{ fontSize: '0.85rem', color: showAnswer ? 'rgba(255, 255, 255, 0.9)' : getClassColor(currentMed.category), marginBottom: '1rem', textTransform: 'uppercase', letterSpacing: '0.1em', fontWeight: 700 }}>
                  {showAnswer ? 'DCI' : 'Nom Commercial'}
                </div>
                <div style={{ fontSize: showAnswer ? '2.5rem' : '1.8rem', fontWeight: 700, color: showAnswer ? 'white' : '#1e293b', marginBottom: '1rem', textAlign: 'center' }}>
                  {showAnswer ? currentMed.dci : currentMed.commercial.join(' ‚Ä¢ ')}
                </div>
                <div style={{ display: 'inline-block', padding: '0.5rem 1.5rem', background: showAnswer ? 'rgba(255, 255, 255, 0.2)' : `${getClassColor(currentMed.category)}20`, borderRadius: '20px', color: showAnswer ? 'white' : getClassColor(currentMed.category), fontSize: '0.85rem', fontWeight: 600 }}>
                  {currentMed.category}
                </div>
              </div>
              
              {showAnswer && (
                <div style={{ display: 'flex', gap: '0.75rem', marginTop: '1.5rem' }}>
                  <button onClick={() => handleSRSResponse(0)} className="button-hover" style={{ flex: 1, padding: '1rem', background: '#FEE2E2', border: '2px solid #EF4444', borderRadius: '12px', color: '#DC2626', cursor: 'pointer', fontWeight: 600 }}>
                    Faux
                    <div style={{ fontSize: '0.7rem', opacity: 0.7, marginTop: '0.25rem' }}>Pas du tout ma√Ætris√©</div>
                  </button>
                  <button onClick={() => handleSRSResponse(1)} className="button-hover" style={{ flex: 1, padding: '1rem', background: '#FEF3C7', border: '2px solid #F59E0B', borderRadius: '12px', color: '#D97706', cursor: 'pointer', fontWeight: 600 }}>
                    Difficile
                    <div style={{ fontSize: '0.7rem', opacity: 0.7, marginTop: '0.25rem' }}>J'ai h√©sit√©</div>
                  </button>
                  <button onClick={() => handleSRSResponse(2)} className="button-hover" style={{ flex: 1, padding: '1rem', background: '#D1FAE5', border: '2px solid #10B981', borderRadius: '12px', color: '#059669', cursor: 'pointer', fontWeight: 600 }}>
                    Correct
                    <div style={{ fontSize: '0.7rem', opacity: 0.7, marginTop: '0.25rem' }}>Parfaitement ma√Ætris√©</div>
                  </button>
                </div>
              )}
            </div>
          )}

          {/* MODE QUIZ */}
          {mode === 'quiz' && currentMed && (
            <div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                <div style={{ fontSize: '0.9rem', color: '#64748b', fontWeight: 600 }}>Question {currentIndex + 1} / {shuffledMeds.length}</div>
                <div style={{ display: 'flex', gap: '0.5rem' }}>
                  <button onClick={() => setMode('menu')} className="button-hover" style={{ padding: '0.6rem 1rem', background: '#e2e8f0', border: '2px solid #cbd5e1', borderRadius: '8px', cursor: 'pointer', fontWeight: 600, color: '#1e293b', fontSize: '0.9rem' }}>
                    Menu
                  </button>
                  <button onClick={() => setShowSettings(true)} className="button-hover" style={{ padding: '0.6rem', background: '#f1f5f9', border: '2px solid #e2e8f0', borderRadius: '8px', cursor: 'pointer' }}>
                    <Settings size={20} style={{ color: '#64748b' }} />
                  </button>
                </div>
              </div>

              <div style={{ background: 'white', border: `3px solid ${getClassColor(currentMed.category)}`, borderRadius: '20px', padding: '2rem', marginBottom: '1.5rem' }}>
                {currentMed.image && (
                  <img src={currentMed.image} alt="M√©dicament" style={{ maxWidth: '200px', maxHeight: '150px', objectFit: 'contain', display: 'block', margin: '0 auto 1.5rem', borderRadius: '12px' }} />
                )}
                <div style={{ fontSize: '0.85rem', color: getClassColor(currentMed.category), marginBottom: '1rem', textAlign: 'center', textTransform: 'uppercase', letterSpacing: '0.1em', fontWeight: 700 }}>
                  Nom Commercial
                </div>
                <div style={{ fontSize: '1.8rem', fontWeight: 700, color: '#1e293b', marginBottom: '1rem', textAlign: 'center' }}>
                  {currentMed.commercial.join(' ‚Ä¢ ')}
                </div>
                <div style={{ display: 'flex', justifyContent: 'center' }}>
                  <div style={{ display: 'inline-block', padding: '0.5rem 1.5rem', background: `${getClassColor(currentMed.category)}20`, borderRadius: '20px', color: getClassColor(currentMed.category), fontSize: '0.85rem', fontWeight: 600 }}>
                    {currentMed.category}
                  </div>
                </div>
              </div>

              {!showQuizFeedback ? (
                <form onSubmit={handleQuizSubmit}>
                  <input 
                    type="text" 
                    value={userAnswer} 
                    onChange={(e) => setUserAnswer(e.target.value)} 
                    placeholder="Entrez le DCI..." 
                    autoFocus 
                    style={{ width: '100%', padding: '1rem', border: '2px solid #e2e8f0', borderRadius: '12px', fontSize: '1rem', marginBottom: '1rem' }} 
                  />
                  <button type="submit" className="button-hover" style={{ width: '100%', padding: '1rem', background: '#334155', border: 'none', borderRadius: '12px', color: 'white', cursor: 'pointer', fontWeight: 600, fontSize: '1rem' }}>
                    Valider
                  </button>
                </form>
              ) : (
                <div>
                  <div style={{ padding: '1.5rem', background: checkAnswer(userAnswer, currentMed.dci) ? '#D1FAE5' : '#FEE2E2', borderRadius: '12px', marginBottom: '1rem', border: `2px solid ${checkAnswer(userAnswer, currentMed.dci) ? '#10B981' : '#EF4444'}` }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.75rem' }}>
                      {checkAnswer(userAnswer, currentMed.dci) ? (
                        <>
                          <Check size={24} style={{ color: '#059669' }} />
                          <span style={{ fontSize: '1.1rem', fontWeight: 700, color: '#059669' }}>Correct !</span>
                        </>
                      ) : (
                        <>
                          <X size={24} style={{ color: '#DC2626' }} />
                          <span style={{ fontSize: '1.1rem', fontWeight: 700, color: '#DC2626' }}>Incorrect</span>
                        </>
                      )}
                    </div>
                    <div style={{ fontSize: '0.9rem', color: '#1e293b' }}>
                      <div>Votre r√©ponse : <strong>{userAnswer || '(vide)'}</strong></div>
                      <div>Bonne r√©ponse : <strong>{currentMed.dci}</strong></div>
                    </div>
                  </div>
                  <button onClick={handleNext} className="button-hover" style={{ width: '100%', padding: '1rem', background: '#334155', border: 'none', borderRadius: '12px', color: 'white', cursor: 'pointer', fontWeight: 600, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>
                    <span>Suivant</span>
                    <ChevronRight size={20} />
                  </button>
                </div>
              )}
            </div>
          )}

          {/* MODAL SETTINGS */}
          {showSettings && (
            <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem' }} onClick={() => { setShowSettings(false); setSelectionMode('all'); }}>
              <div onClick={(e) => e.stopPropagation()} style={{ background: 'white', borderRadius: '20px', padding: '2rem', maxWidth: '600px', width: '100%', maxHeight: '90vh', overflowY: 'auto' }}>
                <h2 style={{ fontSize: '1.5rem', marginBottom: '1.5rem', color: '#1e293b' }}>S√©lection</h2>
                
                <div style={{ marginBottom: '1.5rem' }}>
                  <div style={{ marginBottom: '1rem' }}>
                    <label style={{ display: 'flex', alignItems: 'center', padding: '1rem', background: selectionMode === 'all' ? '#EFF6FF' : 'white', border: `2px solid ${selectionMode === 'all' ? '#3B82F6' : '#e2e8f0'}`, borderRadius: '12px', cursor: 'pointer', marginBottom: '0.5rem' }}>
                      <input type="radio" name="mode" value="all" checked={selectionMode === 'all'} onChange={(e) => setSelectionMode(e.target.value)} style={{ marginRight: '0.75rem' }} />
                      <span style={{ fontWeight: 600, color: '#1e293b' }}>Tous les m√©dicaments ({medications.length})</span>
                    </label>
                    
                    <label style={{ display: 'flex', alignItems: 'center', padding: '1rem', background: selectionMode === 'class' ? '#EFF6FF' : 'white', border: `2px solid ${selectionMode === 'class' ? '#3B82F6' : '#e2e8f0'}`, borderRadius: '12px', cursor: 'pointer' }}>
                      <input type="radio" name="mode" value="class" checked={selectionMode === 'class'} onChange={(e) => setSelectionMode(e.target.value)} style={{ marginRight: '0.75rem' }} />
                      <span style={{ fontWeight: 600, color: '#1e293b' }}>S√©lection par classe</span>
                    </label>
                  </div>

                  {selectionMode === 'class' && (
                    <div style={{ padding: '1rem', background: '#f8fafc', borderRadius: '12px', border: '2px solid #e2e8f0' }}>
                      <div style={{ fontSize: '0.85rem', color: '#64748b', marginBottom: '0.75rem', fontWeight: 600 }}>Classes th√©rapeutiques :</div>
                      <div style={{ display: 'flex', flexWrap: 'wrap', gap: '0.5rem' }}>
                        {getCategories().map(cat => {
                          const count = medications.filter(m => m.category === cat).length;
                          const isSelected = selectedClasses.includes(cat);
                          return (
                            <button 
                              key={cat}
                              onClick={() => setSelectedClasses(
                                isSelected 
                                  ? selectedClasses.filter(c => c !== cat) 
                                  : [...selectedClasses, cat]
                              )}
                              style={{ 
                                padding: '0.5rem 1rem', 
                                background: isSelected ? getClassColor(cat) : 'white', 
                                border: `2px solid ${getClassColor(cat)}`, 
                                borderRadius: '8px', 
                                color: isSelected ? 'white' : getClassColor(cat), 
                                cursor: 'pointer', 
                                fontWeight: 600, 
                                fontSize: '0.85rem',
                                transition: 'all 0.2s'
                              }}
                            >
                              {cat} ({count})
                            </button>
                          );
                        })}
                      </div>
                    </div>
                  )}
                </div>

                <div style={{ display: 'flex', gap: '1rem' }}>
                  <button onClick={() => { setShowSettings(false); setSelectionMode('all'); }} className="button-hover" style={{ flex: 1, padding: '1rem', background: '#e2e8f0', border: 'none', borderRadius: '12px', color: '#1e293b', cursor: 'pointer', fontWeight: 600 }}>
                    Annuler
                  </button>
                  <button onClick={applySelection} className="button-hover" style={{ flex: 1, padding: '1rem', background: '#334155', border: 'none', borderRadius: '12px', color: 'white', cursor: 'pointer', fontWeight: 600 }}>
                    Appliquer
                  </button>
                </div>
              </div>
            </div>
          )}


          {/* MODAL GESTION */}
          {showManagement && (
            <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem' }} onClick={() => { setShowManagement(false); cancelEdit(); setErrorMessage(''); setShowClassManager(false); setEditingClass(null); }}>
              <div onClick={(e) => e.stopPropagation()} style={{ background: 'white', borderRadius: '20px', padding: '2rem', maxWidth: '700px', width: '100%', maxHeight: '90vh', overflowY: 'auto' }}>
                <h2 style={{ fontSize: '1.5rem', marginBottom: '1.5rem', color: '#1e293b' }}>Gestion des cartes</h2>

                {errorMessage && (
                  <div style={{ padding: '1rem', background: '#FEE2E2', border: '2px solid #DC2626', borderRadius: '8px', color: '#991B1B', marginBottom: '1rem', fontSize: '0.9rem' }}>
                    {errorMessage}
                  </div>
                )}

                <div style={{ padding: '1.5rem', background: editingIndex !== null ? '#FEF3C7' : '#f8fafc', borderRadius: '12px', marginBottom: '1.5rem', border: editingIndex !== null ? '2px solid #F59E0B' : 'none' }}>
                  <h3 style={{ fontSize: '1rem', marginBottom: '1rem', color: '#1e293b' }}>
                    {editingIndex !== null ? '‚úèÔ∏è Modifier' : '‚ûï Ajouter'}
                  </h3>
                  
                  <input type="text" placeholder="DCI *" value={customMed.dci} onChange={(e) => setCustomMed({...customMed, dci: e.target.value})} style={{ width: '100%', padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', marginBottom: '0.75rem', fontSize: '0.9rem' }} />
                  
                  <input type="text" placeholder="Nom(s) commercial(aux) s√©par√©s par des virgules *" value={customMed.commercial} onChange={(e) => setCustomMed({...customMed, commercial: e.target.value})} style={{ width: '100%', padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', marginBottom: '0.75rem', fontSize: '0.9rem' }} />
                  
                  <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '0.75rem' }}>
                    <select value={customMed.category} onChange={(e) => setCustomMed({...customMed, category: e.target.value})} style={{ flex: 1, padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.9rem', cursor: 'pointer' }}>
                      <option value="">-- S√©lectionner --</option>
                      {getCategories().map(cat => (
                        <option key={cat} value={cat}>{cat}</option>
                      ))}
                    </select>
                    <button onClick={() => setShowClassManager(!showClassManager)} className="button-hover" style={{ padding: '0.75rem', background: showClassManager ? '#3B82F6' : '#e2e8f0', border: 'none', borderRadius: '8px', color: showClassManager ? 'white' : '#64748b', cursor: 'pointer', fontWeight: 600, fontSize: '0.85rem' }}>
                      + Nouvelle
                    </button>
                  </div>
                  
                  {showClassManager && (
                    <div style={{ padding: '1rem', background: 'white', borderRadius: '8px', marginBottom: '0.75rem', border: '2px solid #3B82F6' }}>
                      <div style={{ fontSize: '0.85rem', fontWeight: 600, marginBottom: '0.5rem', color: '#1e293b' }}>Ajouter une nouvelle classe</div>
                      <input type="text" placeholder="Nom de la classe" value={newClassName} onChange={(e) => setNewClassName(e.target.value)} style={{ width: '100%', padding: '0.5rem', border: '2px solid #e2e8f0', borderRadius: '6px', marginBottom: '0.5rem', fontSize: '0.85rem' }} />
                      <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem' }}>
                        <input type="color" value={newClassColor} onChange={(e) => setNewClassColor(e.target.value)} style={{ width: '40px', height: '40px', border: 'none', borderRadius: '6px', cursor: 'pointer' }} />
                        <div style={{ flex: 1, padding: '0.5rem', background: newClassColor, borderRadius: '6px', color: 'white', textAlign: 'center', fontWeight: 600, fontSize: '0.85rem' }}>
                          Aper√ßu
                        </div>
                      </div>
                      <button onClick={addNewClass} className="button-hover" style={{ width: '100%', padding: '0.5rem', background: '#10B981', border: 'none', borderRadius: '6px', color: 'white', cursor: 'pointer', fontWeight: 600, fontSize: '0.85rem' }}>
                        Ajouter
                      </button>
                      
                      <div style={{ marginTop: '1rem', paddingTop: '1rem', borderTop: '1px solid #e2e8f0' }}>
                        <div style={{ fontSize: '0.85rem', fontWeight: 600, marginBottom: '0.5rem', color: '#1e293b' }}>G√©rer les classes existantes</div>
                        {Object.entries(therapeuticClasses).map(([className, color]) => {
                          const isEditing = editingClass === className;
                          const medsInClass = medications.filter(m => m.category === className).length;
                          return (
                            <div key={className} style={{ padding: '0.5rem', background: isEditing ? '#FEF3C7' : '#f8fafc', borderRadius: '6px', marginBottom: '0.5rem', border: isEditing ? '2px solid #F59E0B' : '1px solid #e2e8f0' }}>
                              {isEditing ? (
                                <div>
                                  <input type="text" defaultValue={className} id={`edit-${className}`} style={{ width: '100%', padding: '0.4rem', border: '1px solid #e2e8f0', borderRadius: '4px', marginBottom: '0.3rem', fontSize: '0.8rem' }} />
                                  <div style={{ display: 'flex', gap: '0.3rem', marginBottom: '0.3rem' }}>
                                    <input type="color" defaultValue={color} id={`color-${className}`} style={{ width: '30px', height: '30px', border: 'none', borderRadius: '4px' }} />
                                    <div style={{ flex: 1, padding: '0.3rem', background: document.getElementById(`color-${className}`)?.value || color, borderRadius: '4px', color: 'white', textAlign: 'center', fontSize: '0.75rem', fontWeight: 600' }}>
                                      Aper√ßu
                                    </div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '0.3rem' }}>
                                    <button onClick={() => { const newName = document.getElementById(`edit-${className}`).value; const newColor = document.getElementById(`color-${className}`).value; updateClass(className, newName, newColor); }} className="button-hover" style={{ flex: 1, padding: '0.4rem', background: '#10B981', border: 'none', borderRadius: '4px', color: 'white', cursor: 'pointer', fontSize: '0.75rem', fontWeight: 600 }}>
                                      Valider
                                    </button>
                                    <button onClick={() => setEditingClass(null)} className="button-hover" style={{ flex: 1, padding: '0.4rem', background: '#e2e8f0', border: 'none', borderRadius: '4px', color: '#64748b', cursor: 'pointer', fontSize: '0.75rem', fontWeight: 600 }}>
                                      Annuler
                                    </button>
                                  </div>
                                </div>
                              ) : (
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                  <div style={{ width: '20px', height: '20px', background: color, borderRadius: '4px' }} />
                                  <span style={{ flex: 1, fontSize: '0.85rem', fontWeight: 600, color: '#1e293b' }}>{className} ({medsInClass})</span>
                                  <button onClick={() => setEditingClass(className)} className="button-hover" style={{ padding: '0.3rem', background: '#DBEAFE', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>
                                    <Edit size={12} color="#1E40AF" />
                                  </button>
                                  <button type="button" onClick={() => {
                                    console.log('=== CLIC SUR BOUTON SUPPRIMER CLASSE ===');
                                    console.log('className:', className);
                                    const medsCount = medications.filter(m => m.category === className).length;
                                    console.log('Nombre de m√©dicaments avec cette classe:', medsCount);
                                    if (medsCount > 0) {
                                      const updatedMeds = medications.map(med => 
                                        med.category === className ? {...med, category: 'Non attribu√©e'} : med
                                      );
                                      setMedications(updatedMeds);
                                      if (!therapeuticClasses['Non attribu√©e']) {
                                        setTherapeuticClasses({...therapeuticClasses, 'Non attribu√©e': '#9CA3AF'});
                                      }
                                    }
                                    console.log('Suppression directe');
                                    const updated = {...therapeuticClasses};
                                    delete updated[className];
                                    console.log('Nouveau dictionnaire de classes:', updated);
                                    setTherapeuticClasses(updated);
                                    console.log('Suppression classe termin√©e');
                                  }} className="button-hover" style={{ padding: '0.3rem', background: '#FEE2E2', border: 'none', borderRadius: '4px', cursor: 'pointer' }}>
                                    <Trash2 size={12} color="#DC2626" />
                                  </button>
                                </div>
                              )}
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}
                  
                  <div style={{ marginBottom: '0.75rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', color: '#64748b', fontWeight: 600 }}>
                      Image (optionnel) {customMed.image && '‚úì'}
                    </label>
                    <input type="file" accept="image/*" onChange={handleImageUpload} style={{ width: '100%', padding: '0.5rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.85rem' }} />
                  </div>
                  
                  <div style={{ display: 'flex', gap: '0.5rem' }}>
                    {editingIndex !== null && (
                      <button onClick={cancelEdit} className="button-hover" style={{ flex: 1, padding: '0.75rem', background: '#e2e8f0', border: 'none', borderRadius: '8px', color: '#64748b', cursor: 'pointer', fontWeight: 600, fontSize: '0.9rem' }}>
                        Annuler
                      </button>
                    )}
                    <button onClick={saveMedication} className="button-hover" style={{ flex: 1, padding: '0.75rem', background: '#10B981', border: 'none', borderRadius: '8px', color: 'white', cursor: 'pointer', fontWeight: 600, fontSize: '0.9rem' }}>
                      {editingIndex !== null ? 'Modifier' : 'Ajouter'}
                    </button>
                  </div>
                </div>

                <div style={{ marginBottom: '1rem' }}>
                  <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '0.75rem' }}>
                    <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} style={{ flex: 1, padding: '0.5rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.85rem', cursor: 'pointer' }}>
                      <option value="dci">Trier par: DCI</option>
                      <option value="commercial">Trier par: Nom commercial</option>
                      <option value="category">Trier par: Classe</option>
                    </select>
                    <select value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)} style={{ flex: 1, padding: '0.5rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.85rem', cursor: 'pointer' }}>
                      <option value="all">Toutes les classes</option>
                      {getCategories().map(cat => (
                        <option key={cat} value={cat}>{cat}</option>
                      ))}
                    </select>
                  </div>
                </div>

                <div style={{ maxHeight: '300px', overflowY: 'auto', marginBottom: '1rem' }}>
                  {getSortedMedications().map((med, i) => {
                    const originalIndex = medications.indexOf(med);
                    const isEditing = editingIndex === originalIndex;
                    return (
                      <div key={i} style={{ padding: '1rem', background: isEditing ? '#FEF3C7' : 'white', border: `2px solid ${getClassColor(med.category)}`, borderRadius: '8px', marginBottom: '0.5rem', display: 'flex', gap: '1rem', alignItems: 'center' }}>
                        {med.image ? (
                          <div style={{ position: 'relative' }}>
                            <img src={med.image} alt={med.dci} style={{ width: '50px', height: '50px', objectFit: 'cover', borderRadius: '8px', border: `2px solid ${getClassColor(med.category)}` }} />
                            <div style={{ position: 'absolute', bottom: -4, right: -4, width: '20px', height: '20px', background: '#10B981', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                              <Camera size={12} color="white" />
                            </div>
                          </div>
                        ) : (
                          <div style={{ width: '50px', height: '50px', background: '#f1f5f9', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#cbd5e1' }}>
                            <ImagePlaceholder />
                          </div>
                        )}
                        <div style={{ flex: 1 }}>
                          <div style={{ fontSize: '0.9rem', fontWeight: 700, color: '#1e293b' }}>{med.commercial.join(' ‚Ä¢ ')}</div>
                          <div style={{ fontSize: '0.8rem', color: '#64748b' }}>{med.dci}</div>
                          <div style={{ display: 'inline-block', padding: '0.2rem 0.5rem', background: `${getClassColor(med.category)}20`, borderRadius: '8px', color: getClassColor(med.category), fontSize: '0.7rem', fontWeight: 600, marginTop: '0.25rem' }}>
                            {med.category}
                          </div>
                        </div>
                        <div style={{ display: 'flex', gap: '0.5rem' }}>
                          <button type="button" onClick={() => startEditMedication(originalIndex)} className="button-hover" style={{ padding: '0.5rem', background: isEditing ? '#F59E0B' : '#DBEAFE', border: 'none', borderRadius: '6px', color: isEditing ? 'white' : '#1E40AF', cursor: 'pointer' }}>
                            <Edit size={16} />
                          </button>
                          <button type="button" onClick={() => {
                            console.log('=== CLIC SUR BOUTON SUPPRIMER ===');
                            console.log('originalIndex:', originalIndex);
                            console.log('med:', med);
                            console.log('medications actuel:', medications);
                            console.log('medications.length:', medications.length);
                            console.log('Suppression directe (sans confirmation)');
                            const newMeds = medications.filter((_, idx) => idx !== originalIndex);
                            console.log('Nouveau tableau:', newMeds);
                            console.log('Nouvelle longueur:', newMeds.length);
                            setMedications(newMeds);
                            if (editingIndex === originalIndex) cancelEdit();
                            console.log('Suppression termin√©e');
                          }} className="button-hover" style={{ padding: '0.5rem', background: '#FEE2E2', border: 'none', borderRadius: '6px', color: '#DC2626', cursor: 'pointer' }}>
                            <Trash2 size={16} />
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>

                <button onClick={() => { setShowManagement(false); cancelEdit(); setErrorMessage(''); setShowClassManager(false); setEditingClass(null); }} className="button-hover" style={{ width: '100%', marginTop: '1rem', padding: '1rem', background: '#e2e8f0', border: 'none', borderRadius: '12px', color: '#1e293b', cursor: 'pointer', fontWeight: 600 }}>
                  Fermer
                </button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PharmaQuizz />);
  </script>
</body>
</html>
